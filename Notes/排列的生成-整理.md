# 递增进制法

## 中介数

$a_n$ $a_{n-1}$ $\cdots$ $a_2$，其中 $a_i$ 表示 $i$ 的右边比 $i$ 小的数字个数

| 中介数 | 排列  |
| ------ | ----- |
| 0000   | 12345 |
| 0001   | 21345 |
| 0010   | 13245 |
| 0011   | 23145 |
| 0100   | 12435 |


## 中介数转排列

从 $a_n$ 往 $a_2$ 填即可

**e.g.** 中介数是 $67342221$，求排列

| 中介数       | 排列                                  |
| ------------ | ------------------------------------- |
| $a_9=6$      | $\texttt{..\textcolor{red}{9}......}$ |
| $a_8=7$      | $\texttt{\textcolor{red}{8}.9......}$ |
| $a_7=3$      | $\texttt{8.9..\textcolor{red}{7}...}$ |
| $a_6=4$      | $\texttt{8.9\textcolor{red}{6}.7...}$ |
| $a_5=2$      | $\texttt{8.96.7\textcolor{red}{5}..}$ |
| $a_4=2$      | $\texttt{8.96\textcolor{red}{4}75..}$ |
| $a_3=2$      | $\texttt{8\textcolor{red}{3}96475..}$ |
| $a_2=1$      | $\texttt{8396475\textcolor{red}{2}.}$ |
| 1 没有中介数 | $\texttt{83964752\textcolor{red}{1}}$ |

## 序号

$$
m=\sum_{i=2}^{n}a_i(i-1)!
$$

其中 $a_i$ 是中介数

## 序号转中介数

$$
\begin{eqnarray}
m&=&a_2+2!a_3+3!a_4+\cdots+(n-1)!a_n\\
&=&a_2+2(a_3+3(a_4+\cdots+(n-1)a_n))
\end{eqnarray}
$$

所以我们从 $i=2$ 到 $i=n$，每次对 $m$ 做带余除法，余数为当前的 $a_i$ ，商进行下一次带余除法

**e.g.** 9 位排列，序号是 $279905$，求中介数
$$
\begin{eqnarray}
279905\div2&=&139952\cdots1\\
139952\div3&=&46650\cdots2\\
46650\div4&=&11662\cdots2\\
11662\div5&=&2332\cdots2\\
2332\div6&=&388\cdots4\\
388\div7&=&55\cdots3\\
55\div8&=&6\cdots7\\
6\div9&=&0\cdots6
\end{eqnarray}
$$

所以中介数就是 $67342221$

## 下一个排列

**e.g.** 求 $839647521$ 的下一个排列

找到最长的逆序对，$8\textcolor{Cerulean}{3}96\textcolor{red}{4}75\textcolor{Cerulean}{21}$，4 在标了颜色的数中向前移一位，并把 1~3 按顺序填好，得到下一个排列是 $8\textcolor{red}{4}96\textcolor{Cerulean}{1}75\textcolor{Cerulean}{23}$

# 递减进制法

## 中介数

$a_2$ $a_3$ $\cdots$ $a_n$，其中 $a_i$ 仍表示 $i$ 的右边比 $i$ 小的数字个数

| 中介数 | 排列  |
| ------ | ----- |
| 0004   | 51234 |
| 0010   | 12435 |
| 0134   | 54132 |
| 0200   | 31245 |

## 中介数转排列

跟递增进制法一样，从 $a_n$ 往 $a_2$ 填即可，此处略

## 序号

$$
\begin{eqnarray}
m&=&a_n+a_{n-1}\cdot n+a_{n-2}\cdot n(n-1)+\cdots+a_2\frac{n!}{2}\\
&=&n!\sum_{i=2}^{n}\frac{a_i}{i!}
\end{eqnarray}
$$

## 序号转中介数

$$
\begin{eqnarray}
m&=&a_n+a_{n-1}\cdot n+a_{n-2}\cdot n(n-1)+\cdots+a_2\frac{n!}{2}\\
&=&a_n+n(a_{n-1}+(n-1)(a_{n-2}+\cdots+(3a_2))\\
\end{eqnarray}
$$

类似于递增进制法，但是从 $i=n$ 到 $i=2$ 进行带余除法

**e.g.** 9 位排列，序号是 $340989$，求中介数
$$
\begin{eqnarray}
340989\div9&=&37887\cdots6\\
37887\div8&=&4735\cdots7\\
4735\div7&=&676\cdots3\\
676\div6&=&112\cdots4\\
112\div5&=&22\cdots2\\
22\div4&=&5\cdots2\\
5\div3&=&1\cdots2\\
1\div2&=&0\cdots1
\end{eqnarray}
$$

所以中介数就是 $12224376$

## 下一个排列

设 $k$ 是能往左移的最大的数，将 $k$ 往左移一位 ，$k+1$ 到 $n$ 按顺序回到最后

**e.g.**

- $83\textcolor{red}{9}647521$ 的下一个排列是 $8\textcolor{red}{9}3647521$
- $\textcolor{Cerulean}{987}5423\textcolor{red}{6}1$ 的下一个排列是 $542\textcolor{red}{6}31\textcolor{Cerulean}{789}$

# 字典序法

## 中介数

$k_1$ $k_2$ $\cdots$ $k_{n-1}$，其中 $k_i$ 表示 $p_i$ 的右边比 $p_i$ 小的数字个数

## 中介数转排列

从 $k_1$ 往 $k_n$ 填

**e.g.** 中介数是 72642321，求排列

| 中介数  | 剩余数字                     | 前缀        |
| ------- | ---------------------------- | ----------- |
| $k_1=7$ | $1234567\textcolor{red}{8}9$ | $8$         |
| $k_2=2$ | $12\textcolor{red}{3}45679$  | $83$        |
| $k_3=6$ | $124567\textcolor{red}{9}$   | $839$       |
| $k_4=4$ | $1245\textcolor{red}{6}7$    | $8396$      |
| $k_5=2$ | $12\textcolor{red}{4}57$     | $83964$     |
| $k_6=3$ | $125\textcolor{red}{7}$      | $839647$    |
| $k_7=2$ | $12\textcolor{red}{5}$       | $8396475$   |
| $k_8=1$ | $1\textcolor{red}{2}$        | $83964752$  |
|         | $\textcolor{red}{1}$         | $839647521$ |

## 序号

$$
m=\sum_{i=1}^{n-1}k_i(n-i)!
$$

## 序号转中介数

$$
\begin{eqnarray}
m&=&(n-1)!k_1+(n-2)!k_2+\cdots+2!k_{n-2}+k_{n-1}\\
&=&k_{n-1}+2(k_{n-2}+3(k_{n-3}+\cdots+(n-1)k_1))
\end{eqnarray}
$$

看式子就知道跟递增进制法基本一致，从 $i=2$ 到 $i=n$，每次对 $m$ 做带余除法，余数为 $k_{n-i+1}$ ，商进行下一次带余除法

**e.g.** 序号是 $297191$
$$
\begin{eqnarray}
297191\div2&=&148595\cdots1\\
148595\div3&=&49531\cdots2\\
49531\div4&=&12382\cdots3\\
12382\div5&=&2476\cdots2\\
2476\div6&=&412\cdots4\\
412\div7&=&58\cdots6\\
58\div8&=&7\cdots2\\
7\div9&=&0\cdots7
\end{eqnarray}
$$
所以中介数是 $72642321$

## 下一个排列

从后往前找到第一个 $a_i<a_{i+1}$ 的位置，在 $[i+1:n]$ 的后缀中从后往前找到第一个比 $a_i$ 大的位置 $j$ ，交换 $a_i$ 与 $a_j$ 并把交换后的后缀按顺序写

**e.g.** 求 $8396\textcolor{red}{4}\textcolor{Cerulean}{7}\textcolor{red}{5}\textcolor{Cerulean}{21}$ 的下一个排列，后缀中第一个比 4 大的是 5，交换 4 与 5，按顺序写下 1247，即下一个排列是 $8396\textcolor{red}{5}\textcolor{Cerulean}{12}\textcolor{red}{4}\textcolor{Cerulean}{7}$

# 邻位交换法

这个有点神秘，其类似于递减进制法，但是 S 型移动数字

## 中介数

我们令**奇排列**指逆序对数为奇数的排列，**偶排列**为逆序对数为偶数的排列。

我们给数字 $k$ 上定义一个箭头，其方向由 $[1,k-1]$ 的排列决定，偶左奇右，偶$\leftarrow$奇$\rightarrow$

规定 1 的箭头指向左

中介数 $b_2$ $b_3$ $\cdots$ $b_n$，其中 $b_i$ 表示 $i$ 的箭头**反方向**比 $i$ 小的数字个数

## 序号

类似递减进制法

$$
\begin{eqnarray}
m&=&b_n+b_{n-1}\cdot n+b_{n-2}\cdot n(n-1)+\cdots+b_2\frac{n!}{2}\\
&=&n!\sum_{i=2}^{n}\frac{b_i}{i!}
\end{eqnarray}
$$

## 序号转中介数

就跟递减进制法非常类似啦，见下一小节

## 中介数转排列

难点在于，我们不知道当前数的箭头，所以不知道应该从哪边数格子填。

我们先根据中介数计算出序号，然后进行**序号转中介数**的操作，根据每次带余除法的**商的奇偶性**，得出当前数的箭头方向。

以 9 位排列，中介数 $10121372$ 为例。
$$
\begin{eqnarray}
m&=&1*\frac{9!}{2!}+0*\frac{9!}{3!}+1*\frac{9!}{4!}+2*\frac{9!}{5!}+1*\frac{9!}{6!}+3*\frac{9!}{7!}+7*\frac{9!}{8!}+2*\frac{9!}{9!}\\
&=&203393
\end{eqnarray}
$$

$$
\begin{eqnarray}
203393\div9&=&22599\cdots2\\
22599\div8&=&2824\cdots7\\
2824\div7&=&403\cdots3\\
403\div6&=&67\cdots1\\
67\div5&=&13\cdots2\\
13\div4&=&3\cdots1\\
3\div3&=&1\cdots0\\
1\div2&=&0\cdots1
\end{eqnarray}
$$

每一次带余除法中，余数对应的就是中介数，商是**奇数**则$\rightarrow$，是**偶数**则$\leftarrow$。

| 中介数       | 箭头方向      | 排列                                  |
| ------------ | ------------- | ------------------------------------- |
| $b_9=2$      | $\rightarrow$ | $\texttt{..\textcolor{red}{9}......}$ |
| $b_8=7$      | $\leftarrow$  | $\texttt{\textcolor{red}{8}.9......}$ |
| $b_7=3$      | $\rightarrow$ | $\texttt{8.9..\textcolor{red}{7}...}$ |
| $b_6=1$      | $\rightarrow$ | $\texttt{8.9\textcolor{red}{6}.7...}$ |
| $b_5=2$      | $\rightarrow$ | $\texttt{8.96.7\textcolor{red}{5}..}$ |
| $b_4=1$      | $\rightarrow$ | $\texttt{8.96\textcolor{red}{4}75..}$ |
| $b_3=0$      | $\rightarrow$ | $\texttt{8\textcolor{red}{3}96475..}$ |
| $b_2=1$      | $\leftarrow$  | $\texttt{8396475\textcolor{red}{2}.}$ |
| 1 没有中介数 | 不关心        | $\texttt{83964752\textcolor{red}{1}}$ |

## 下一个排列

首先，我们在确定当前排列每个数的箭头方向时，只需要知道逆序对的奇偶性即可，设已经算完了 $[1,i-1]$ 的排列，对于当前数 $i$ ，如果其使排列增加了奇数个逆序对，那我们就在这个数上标一个点，$\dot{i}$

判断是奇排列还是偶排列时，根据点的奇偶性判断即可。

以排列 $839647521$ 为例。

| 排列                         | 逆序增加数 | 奇偶性 |
| ---------------------------- | ---------- | ------ |
| $\textcolor{red}{1}$         |            | 偶     |
| $\textcolor{red}{2}1$        | 奇         | 奇     |
| $\textcolor{red}{3}21$       | 偶         | 奇     |
| $3\textcolor{red}{4}21$      | 偶         | 奇     |
| $34\textcolor{red}{5}21$     | 偶         | 奇     |
| $3\textcolor{red}{6}4521$    | 偶         | 奇     |
| $364\textcolor{red}{7}521$   | 奇         | 偶     |
| $\textcolor{red}{8}3647521$  | 奇         | 奇     |
| $83\textcolor{red}{9}647521$ | 偶         | 奇     |

所以 $\dot{8}3\textcolor{red}{96}4\dot{7}5\dot{2}1$，$\overleftarrow{8}\space\overrightarrow{3}\enspace\textcolor{red}{\overrightarrow{9}}\enspace\textcolor{red}{\overrightarrow{6}}\enspace\overrightarrow{4}\enspace\overrightarrow{7}\enspace\overrightarrow{5}\space\overleftarrow{2}\overleftarrow{1}$，最大的能按箭头方向移动的数是 9，所以下一个排列是 $83\textcolor{red}{69}47521$

# 例题

序号 $202487$，9 位排列，求其在四种排列生成算法下的排列，中介数和下一个排列

|            | 递增进制法                                                   | 递减进制法                   | 字典序法                                                     | 邻位交换法                                   |
| ---------- | ------------------------------------------------------------ | ---------------------------- | ------------------------------------------------------------ | -------------------------------------------- |
| 中介数     | $50111321$                                                   | $10115525$                   | $50111321$                                                   | $10115525$                                   |
| 排列       | $\textcolor{Cerulean}{432}9\textcolor{red}{5}67\textcolor{Cerulean}{1}8$ | $672\textcolor{red}{9}14853$ | $6134\textcolor{red}{5}\textcolor{Cerulean}{98}\textcolor{red}{7}\textcolor{Cerulean}{2}$ | $635\textcolor{red}{\overleftarrow{9}}42871$ |
| 下一个排列 | $\textcolor{Cerulean}{12}\textcolor{red}{5}9\textcolor{Cerulean}{3}67\textcolor{Cerulean}{4}8$ | $67\textcolor{red}{9}214853$ | $6134\textcolor{red}{7}\textcolor{Cerulean}{2}\textcolor{red}{5}\textcolor{Cerulean}{89}$ | $63\textcolor{red}{\overleftarrow{9}}542871$ |

递增进制法、字典序法的中介数计算过程如下：
$$
\begin{eqnarray}
202487\div2&=&101243\cdots1\\
101243\div3&=&33747\cdots2\\
33747\div4&=&8436\cdots3\\
8436\div5&=&1687\cdots1\\
1687\div6&=&281\cdots1\\
281\div7&=&40\cdots1\\
40\div8&=&5\cdots0\\
5\div9&=&0\cdots5
\end{eqnarray}
$$
递减进制法、邻位交换法的中介数计算过程如下：
$$
\begin{eqnarray}
202487\div9&=&22498\cdots5\\
22498\div8&=&2812\cdots2\\
2812\div7&=&401\cdots5\\
401\div6&=&66\cdots5\\
66\div5&=&13\cdots1\\
13\div4&=&3\cdots1\\
3\div3&=&1\cdots0\\
1\div2&=&0\cdots1
\end{eqnarray}
$$
